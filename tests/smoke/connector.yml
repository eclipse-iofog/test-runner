#
# Test connecting to iofog-connector via HTTP
#

---
-  config:
    - testset: "Testing connection to iofog-connector via REST API"
    - timeout: 600000 # 10 seconds

- test:
      - name: "Add Public Pipe"
      - group: "Connector"
      - url: "/api/v2/mapping/add"
      - headers: {'content-type': 'application/x-www-form-urlencoded', 'cache-control': 'no-cache'}
      - method: 'POST'
      - body: "mapping={'type':'public','maxconnections':60,'heartbeatabsencethreshold':200000}"
      - expected_status: [200]
      - extract_binds:
        - 'public_id': {'jsonpath_mini': 'id'}

- test:
      - name: "Add Private Pipe"
      - group: "Connector"
      - url: "/api/v2/mapping/add"
      - headers: {'content-type': 'application/x-www-form-urlencoded', 'cache-control': 'no-cache'}
      - method: 'POST'
      - body: "mapping={'type':'private','maxconnectionsport1':1, 'maxconnectionsport2':1, 'heartbeatabsencethresholdport1':200000, 'heartbeatabsencethresholdport2':200000}"
      - expected_status: [200]
      - extract_binds:
        - 'private_id': {'jsonpath_mini': 'id'}

- test:
      - name: "Remove Public Pipe"
      - group: "Connector"
      - url: "api/v2/mapping/remove"
      - headers: {'content-type': 'application/x-www-form-urlencoded', 'cache-control': 'no-cache'}
      - body: {'template':"mappingid=$public_id"}
      - method: 'POST'
      - expected_status: [200]

- test:
      - name: "Remove Private Pipe"
      - group: "Connector"
      - url: {'template':"/api/v2/mapping/remove"}
      - headers: {'content-type': 'application/x-www-form-urlencoded', 'cache-control': 'no-cache'}
      - body: {'template':"mappingid=$private_id"}
      - method: 'POST'
      - expected_status: [200]